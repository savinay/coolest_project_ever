<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: data/io/Deserializer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: data/io/Deserializer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>define([
	"../container/Point",
	"../container/Stroke",
	"../container/Substroke",
	"../container/Shape",
	"../container/Sketch"
	], function(Point, Stroke, Substroke, Shape, Sketch) {

/**
 * Class for deserializing a representation of an object into a Sketch
 *
 * @class
 * @memberOf io
 * 
 * @constructor
 */
function Deserializer() {

	// Functions

	/** @access public */

	/**
	 * Convert SketchML::JSON into a Sketch object
	 *
	 * @param {string} json SketchML::JSON data to be converted into a Sketch object
	 *
	 * @return {Sketch} Sketch object generated by the JSON data
	 */
	this.fromSketchMLJSON = function(json) {
		var obj = JSON.parse(json); // Parse into a JS object

		// Convert points list into map of point cloud indexed by id
		var p = obj.points;
		var points = {};
		for (var i = 0; i &lt; p.length; i++) {
			points[p[i].id] = new Point(parseInt(p[i].x), parseInt(p[i].y), parseInt(p[i].time), p[i].id);
		}

		// Convert strokes list into map of strokes cloud indexed by id
		var s = obj.strokes;
		var strokes = {};
		for (var i = 0; i &lt; s.length; i++) {
			strokes[s[i].id] = new Stroke([], parseInt(s[i].time), s[i].id);

			var sp = s[i].points;
			for (var j = 0; j &lt; sp.length; j++) {
				strokes[s[i].id].addPoint(points[sp[j]]);
			}
		}

		// Convert substrokes list into map of substroke cloud indexed by id
		var u = obj.substrokes;
		var substrokes = {};
		for (var i = 0; i &lt; u.length; i++) {
			substrokes[u[i].id] = new Substroke(strokes[u[i].parent], [], parseInt(u[i].time), u[i].id);

			var up = u[i].points;
			for (var j = 0; j &lt; up.length; j++) {
				substrokes[u[i].id].addPoint(points[up[j]]);
			}
		}

		// Convert shapes list into map of shape cloud indexed by id
		var h = obj.shapes;
		var shapes = {};
		for (var i = 0; i &lt; h.length; i++) {
			shapes[h[i].id] = new Shape(h[i].subElements, h[i].interpretation, parseFloat(h[i].confidence), parseInt(h[i].time), h[i].id);
		}
		// Once all shapes have been created, turn list of subElements into list of Drawable objects
		// Must be done last to allow for shapes to reference each other by id
		for (var shape in shapes) {
			// Generate a temporary list to hold references to subElements
			var subElements = [];

			// Iterate through the existing ids and push the element references into subElement
			var hs = shapes[shape].getSubElements();
			for (var j = 0; j &lt; hs.length; j++) {
				var se = points[hs[j]]; // Check in points
				if (!se) {
					se = strokes[hs[j]]; // Check in strokes
					if (!se) {
						se = substrokes[hs[j]]; // Check in substrokes
						if (!se) {
							se = shapes[hs[j]]; // Check in shapes
						}
					}
				}
				// Once we have a subElement reference, attach it to the new list
				subElements.push(se);
			}

			// After all references have been obtained, replace the id list with the Drawable object reference list
			shapes[shape].setSubElements(subElements);
		}

		// Finally, create the Sketch object from the SketchML::JSON string
		var sketch = new Sketch(obj.domain, points, strokes, substrokes, shapes, parseInt(obj.time), obj.id);

		// Return the final object
		return sketch;
	}

	/**
	 * Convert SketchML::JSON-basic into a Sketch object
	 *
	 * @param {string} json SketchML::JSON-basic data to be converted into a Sketch object.  This minimal form of SketchML is simply a list of strokes containing a list of points (not this is the fully-compliant version of SketchML::JSON which uses explicit point definition over a point cloud)
	 *
	 * @return {Sketch} Sketch object generated by the JSON data
	 */
	this.fromSketchMLJSONbasic = function(json) {
		var obj = JSON.parse(json); // Parse into a JS object

		// Grab top level elements
		var id = obj.id;
		var time = obj.time;

		// Now iterate through basic object elements (strokes in practice)
		obj = obj.strokes;

		// Prepare to fill the point and stroke cloud objects
		var points = {};
		var strokes = {};

		// Iterate through the stroke list, populate the point cloud and internal point list as the stroke cloud is filled
		for (var i = 0; i &lt; obj.length; i++) {
			var p = [];
			for (var j = 0; j &lt; obj[i].points.length; j++) {
				var point = obj[i].points[j];
				points[point.id] = new Point(parseInt(point.x), parseInt(point.y), parseInt(point.time), point.id);
				p.push(points[point.id]);
			}
			strokes[obj[i].id] = new Stroke(p, parseInt(obj[i].time), obj[i].id)
		}

		// Finally, create the Sketch object with known data
		var sketch = new Sketch([], points, strokes, {}, {}, time, id); // Domain unknown, substrokes, shapes, time, and id will be set to default

		// Return the final object
		return sketch;
	}

};

return Deserializer;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="data.module_container.html">container</a></li><li><a href="data.module_io.html">io</a></li></ul><h3>Classes</h3><ul><li><a href="container.BoundingBox.html">BoundingBox</a></li><li><a href="container.Drawable.html">Drawable</a></li><li><a href="container.Point.html">Point</a></li><li><a href="container.Shape.html">Shape</a></li><li><a href="container.Sketch.html">Sketch</a></li><li><a href="container.Stroke.html">Stroke</a></li><li><a href="container.Substroke.html">Substroke</a></li><li><a href="io.Deserializer.html">Deserializer</a></li><li><a href="io.Serializer.html">Serializer</a></li></ul><h3>Namespaces</h3><ul><li><a href="core.html">core</a></li><li><a href="core.data.html">data</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Oct 12 2016 22:21:55 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
