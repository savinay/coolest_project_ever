<html>
	<head>
		<title>PaperJS - Starter Canvas</title>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<!--For using jquery!-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		  <!--integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="-->
		  <!--crossorigin="anonymous"></script>-->
		<!-- An AMD-loader like RequireJS is necessary for srlib's asynchronous modules -->
		<script src="js/require.js"></script>
		<!-- Load srlib following RequireJS -->
		<script src="js/srlib.js"></script>	
		<!--Paper JS-->
		<script src="js/paper-full.js"></script>
		<!--cool font-->
		<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
		<!--Fonts and styling -- needed?-->
		<link href="css/style.css" rel='stylesheet' type='text/css'/>
		<!--this is the styling for the elements added to the screen-->
		<link rel="stylesheet" type="text/css" href="style.css">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		
		<script type="text/javascript" src="clickAction.js"></script>
		<script type="text/javascript" src="addElems.js"></script>
		<script type="text/javascript" src="geometry.js"></script>
		<script type="text/javascript" src="controls.js"></script>
		<script type="text/javascript" src="recognizer.js"></script>
		<!--include html for sidebar-->
		<link rel="import" href="sidebar.html">
	</head>
	

	<body>
		<button type="button" id="recognitionOnButton" class="btn btn-primary">Turn Recognizer OFF</button>
		<button type="button" id="recognizeFigure" class="btn btn-primary">Recognize</button>
		<button type="button" id="reset" class="btn btn-primary">Reset</button>
		
		<div id="code" style="width: 500px; float: right;">
	
	    </div>
		
		<!--All Objects get inserted inserted after this-->
		<div class="elem_container"></div>
		
		<div style="border-style: outset; position:absolute; left: 10; top: 50; background-color: lightgreen; visibility:hidden " >
			<h3>[CVA, CVP, ERA, ERP]</h3>
			<ul id="elementlist">
				<li id="rectangle">Rectangle...[<span>0 0 0 0</span>]</li>
				<li id="circle">Circle.........[<span>0 0 0 0</span>]</li>
				<li id="triangle">Triangle.....[<span>0 0 0 0</span>]</li>
				<li id="line">Line...........[<span>0 0 0 0</span>]</li>
			</ul>
			<center style="font-family: 'Montserrat', sans-serif;">I think its a
							<span id="prediction">...nothing yet.</span></center>
		</div>
	</body>



<script type="text/paperscript" canvas="canvas">
	// GLOBAL for jquery to know where to insert the elements
	var elements=$(".elem_container");
	// GLOBAL that keeps track of the state of the recognizerButton
	var recognizerOn = false;
	// GLOBAL variables for detecting start and end points of a line
	var startPoint;
	var EndPoint;
	// GLOBAL keeps track of current number of buttonDownPresses
	var countMouseDown = 0;
	// other globals that need commenting
	var combined_stroke = {};
	combined_stroke["outer_shape"] = [];
	combined_stroke["inner_shape"] = []; 

	function toggleRecognizer() {
		if (recognizerOn)
			newstate = "OFF";
		else
			newstate = "ON";
		$("#recognitionOnButton").text("Turn Recognizer " + newstate);
		recognizerOn = !recognizerOn;
	}

	// use keyboard shortcuts
	$(document).on("keypress", function (e) {
		if (e.which == 32) // space bar pressed
			recognizeShape();
		else if (e.which == 114) // 'r' pressed
			$(".elem_container").empty();
		else if (e.which == 116) // 't' pressed
			toggleRecognizer();
		else if (e.which == 13){ // 'backspace' pressed
			console.log($('.elem_container').last().html());
			$('.elem_container').last().remove();
		}
	});

	$("#recognitionOnButton").click(function(){
		toggleRecognizer();
	});
	
	$("#recognizeFigure").click(function() {
		recognizeShape();	
	});
	
	$("#reset").click(function() {
		$(".elem_container").empty();
	});


var recognizeShape = function () {
		var all_strokes = sketch.getStrokes();
		console.log(combined_stroke);
		path.removeSegments();
		endPoint = event.point;
		console.log(combined_stroke["outer_shape"]);
		var shape = recognize(combined_stroke["outer_shape"]); //stroke.getPoints() 
		console.log("stroke: ", stroke);
		console.log("outer_shape: ", shape);
		startPoint_x_outer -= 5;
		startPoint_y_outer += 25;
		if (shape == "rectangle"){
			var coordinates = getExtremes(combined_stroke["outer_shape"]);
			var inner_points = getInnerPoints(combined_stroke["outer_shape"], coordinates);
			var width = coordinates.max_x - coordinates.min_x;
			var height = coordinates.max_y - coordinates.min_y;
			var area = (coordinates.max_x - coordinates.min_x) * (coordinates.max_y - coordinates.min_y);
			if (area > 2000) {
				if (combined_stroke["inner_shape"].length > 0) {
					var inner_shape = recognize(combined_stroke["inner_shape"]);
					var coordinates_inner_shape = getExtremes(combined_stroke["inner_shape"]);
					var mid_point = (coordinates.max_x + coordinates.min_x)/2;
					console.log(inner_shape);
					if (inner_shape == "triangle") {
						var coordinates_inner_shape = getExtremes(combined_stroke["inner_shape"]);
						var mid_point = (coordinates.max_x + coordinates.min_x)/2;
						console.log("inner_shape: ", mid_point, coordinates_inner_shape.max_x, coordinates_inner_shape.min_x);
						if (coordinates_inner_shape.max_x < mid_point * 1.1 && coordinates_inner_shape.min_x > mid_point * 0.9)
							addVideo(width, height, startPoint_x_outer, startPoint_y_outer);
						else if (coordinates_inner_shape.max_x > mid_point * 1.1)
							addDropdown(width, height, startPoint_x_outer, startPoint_y_outer);
					}
					else if (inner_shape == "rectangle")
						addImage(width, height, startPoint_x_outer, startPoint_y_outer);
					else if (inner_shape == "line") {
						// getEndPointsOfLine();
						var slope = getEndPointsOfLine(combined_stroke["inner_shape"]);
						if (slope <= 0.1) 
							addButton(width, height, startPoint_x_outer, startPoint_y_outer);
						if (slope >= 0.9) 
							addNavbar(width, height, startPoint_x_outer, startPoint_y_outer);
					}
						

					else if ((inner_shape == "circle" || inner_shape == "rectangle") && coordinates_inner_shape.max_x > mid_point * 1.1 && (coordinates.max_y - coordinates.min_y)/(coordinates.max_x - coordinates.min_x) < 0.4 ) {

						addSearchBar(width, height, startPoint_x_outer, startPoint_y_outer);
					}
					
				} else
					addTextArea(width, height, startPoint_x_outer, startPoint_y_outer);
			} else {
				addCheckBox(width, height, startPoint_x_outer, startPoint_y_outer);
			}
		}
		
		if (shape == "circle") {
			addRadioButton(width, height, startPoint_x_outer, startPoint_y_outer);
		}
		paper.project.clear();
		add_jquery();
		countMouseDown = 0;
		sketch = new srlib.core.data.container.Sketch();
		path = new Path();
		stroke = new srlib.core.data.container.Stroke();
		point = new srlib.core.data.container.Point();
		var all_strokes = [];
		// combined_stroke = {};
		combined_stroke["outer_shape"] = [];
		combined_stroke["inner_shape"] = [];
	}

	

	// ...... PAPER JS CODE FOR ADDING POINTS ON MOUSE DRAGGING .......
	function onMouseDown(event) {
		// PaperJS add a new Path object and initial starting point
		countMouseDown += 1;
		
		// start new path and set settings
		path = new Path();
		path.strokeColor = 'blue';
		path.strokeWidth = 2;
		path.add(event.point);
		startPoint = event.point;
		sketch = new srlib.core.data.container.Sketch();
		
		// SRLlib add a new Stroke object and initial starting point
		stroke = new srlib.core.data.container.Stroke();
		point = new srlib.core.data.container.Point(event.point.x,event.point.y)
		if (countMouseDown==1) {
			startPoint_x_outer = point.x;
			startPoint_y_outer = point.y;
		}
		if (countMouseDown == 2) {
			startPoint_x_inner = point.x;
			startPoint_y_inner = point.y;
		}
		
		sketch = new srlib.core.data.container.Sketch();
		sketch.addStroke(stroke);
		sketch.addPoint(point);
		stroke.addPoint(point);
	}

	function onMouseDrag(event) {
		// PaperJS add points to Path object on mouse drag
		path.add(event.point);
		point = new srlib.core.data.container.Point(event.point.x,event.point.y)
		sketch.addPoint(point);
		stroke.addPoint(point);
	}

	function onMouseUp(event) {
		var all_strokes = sketch.getStrokes();
		if(countMouseDown == 1) {
			for (var key in all_strokes)
				combined_stroke["outer_shape"] = combined_stroke["outer_shape"].concat(all_strokes[key].getPoints());
		}
		if (countMouseDown == 2) {
			var coordinates = getExtremes(combined_stroke["outer_shape"]);
			var inner_points = getInnerPoints(combined_stroke["outer_shape"], coordinates);
			console.log(inner_points);
			for (var key in all_strokes)
				combined_stroke["inner_shape"] = combined_stroke["inner_shape"].concat(all_strokes[key].getPoints());
		}
		
	}
</script>	
	
<canvas id="canvas" rezise="true"></canvas>
	
	
</html>

