<html>
	<head>
		<title>PaperJS - Starter Canvas</title>
		<!--For using jquery!-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		  <!--integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA="-->
		  <!--crossorigin="anonymous"></script>-->
		<!-- An AMD-loader like RequireJS is necessary for srlib's asynchronous modules -->
		<script src="js/require.js"></script>
		<!-- Load srlib following RequireJS -->
		<script src="js/srlib.js"></script>	
		<!--Paper JS-->
		<script src="js/paper-full.js"></script>
		<!--cool font-->
		<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
		<!--Fonts and styling -- needed?-->
		<link href="css/style.css" rel='stylesheet' type='text/css'/>
		<!--this is the styling for the elements added to the screen-->
		<link rel="stylesheet" type="text/css" href="style.css">
		<script type="text/javascript" src="jq.js"></script>
		<script type="text/javascript" src="geometry.js"></script>
		<!--this is the reconizer of shapes-->
		<script type="text/javascript" src="recognizer.js"></script>
	</head>
	

	<body>
	<button type="button" id="drawTypeButton">Pictures!</button>
	<button type="button" id="recognitionOnButton">Turn Recognizer ON</button>
	<!--I dont know if these are needed-->
	<p id="log"></p>
	<div class = "sketchProject"></div>
	<div id="chart"></div>
	<div style="border-style: outset; position:absolute; left: 10; top: 50" >
		<h3>[CVA, CVP, ERA, ERP]</h3>
		<ul id="elementlist">
			<li id="rectangle">Rectangle...[<span>0 0 0 0</span>]</li>
			<li id="circle">Circle.........[<span>0 0 0 0</span>]</li>
			<li id="triangle">Triangle.....[<span>0 0 0 0</span>]</li>
			<li id="line">Line...........[<span>0 0 0 0</span>]</li>
		</ul>
		<center style="font-family: 'Montserrat', sans-serif;">I think its a <span id="prediction">...nothing yet.</span></center>
	</div>
	<script type="text/paperscript" canvas="canvas">
	// add a button for switching between drawing text and images
	$("#drawTypeButton").click(function(){
		$(this).toggleClass("picture");
		if ($(this).hasClass("picture"))
			$(this).text("Text Areas!");
		else
			$(this).text("Pictures!");
	});
	
	$("#recognitionOnButton").click(function(){
		$(this).toggleClass("on");
		if ($(this).hasClass("on"))
			$(this).text("Turn Recognizer OFF");
		else
			$(this).text("Turn Recognizer ON");
	});
	// Global variables for detecting start and end points of a line
	// really bad right?? oops
	var startPoint;
	var EndPoint;
	// more globalllls
	var downtime;
	var uptime;
	
	// ...... GEOMETRIC FUNCTIONS .......
	function distance(x1, x2, y1, y2) {
    	return Math.sqrt(Math.pow((x2-x1),2) + Math.pow((y2-y1),2));
	}

	var getExtremes = function(stroke){
		var minx = Number.MAX_VALUE; var maxx = Number.MIN_VALUE;
		var miny = Number.MAX_VALUE; var maxy = Number.MIN_VALUE;
		for (i=0; i<stroke.getNumPoints(); i++){
			var p = stroke.getPointAt(i);
			minx = Math.min(p.getX(), minx);
			miny = Math.min(p.getY(), miny);
			maxx = Math.max(p.getX(), maxx);
			maxy = Math.max(p.getY(), maxy);
		}
		return {"min_x":minx, "max_x":maxx, "min_y":miny, "max_y":maxy};
	}

	var range = function(sketch){
		var extreme =  getExtremes(sketch);
		xrange = extreme["max_x"]-extreme["min_x"];
		yrange = extreme["max_y"]-extreme["min_y"];
		return {"x":xrange, "y":yrange};
	}
	
	// VERY basic way of identifying box
	// based on if ends connect and bigger than certain size
	var isBox = function(sketch){
		var r = range(sketch);
		// not big enough to be a box
		if (r["x"] < 60) return false;
		if (r["y"] < 60) return false;
		var num = stroke.getNumPoints();
		var xstart = stroke.getPointAt(0).getX();
		var xend = stroke.getPointAt(num-1).getX();
		var ystart = stroke.getPointAt(0).getY();
		var yend = stroke.getPointAt(num-1).getY();
		return (distance(xstart, xend, ystart, yend) < 20);
	}

	function codeGenerationTextArea(coordinates) {
	    var max_x = coordinates.max_x;
	    var max_y = coordinates.max_y;
	    var min_x = coordinates.min_x;
	    var min_y = coordinates.min_y;
	    var width = max_x - min_x;
	    var height = max_y - min_y;
	    return [width, height];
	}

	// ...... CODE FOR ADDING ELEMENTS TO DOM .......
	
	var addTextArea = function(w, h, left, top){
		var position = ' style=" position:absolute; left:' + left
			+ 'px; top:' + top + 'px; width:' + w + 'px; height:' + h + 'px;" ';
			$insertion=$('.sketchProject');
		// }
		var id = " id=drawnObject ";
		$insertion.after("<textarea id='draggable' placeholder='You can add text here!'"
								+ id + position + "></textarea>");
	}
	
	var addVideo = function(w, h, left, top){
		var position = ' style=" position:absolute; left:' + left
		+ 'px; top:' + top + 'px; width:' + w + 'px; height:' + h + 'px;" ';
		$insertion=$('.sketchProject');
		var id = " id=vid_placeholder ";
 		$insertion.after("<img src=http://cliparts.co/cliparts/qTB/oq9/qTBoq959c.png "
							+ id + position + "></img>")
	}

	var addButton = function(w, h, left, top){
	var source = "http://www.downloadclipart.net/large/11034-small-button-design.png";
	// var source = '';
	var position = ' style=" position:absolute; left:' + left
	+ 'px; top:' + top + 'px; width:' + w + 'px; height:' + h + 'px;" ';
	$('.sketchProject').after("<img src=" + source + " id=button_placeholder "
								+ position + "></img>");
	}
	
	var addImage = function(w, h, left, top){
		var position = ' style=" position:absolute; left:' + left
			+ 'px; top:' + top + 'px; width:' + w + 'px; height:' + h + 'px;" ';
		var id = " id=drawnObject ";
		$('.sketchProject').after("<img id='picture' src=https://getuikit.com/docs/images/placeholder_600x400.svg "
								+ id + position + "></img>");
	}
	
	var addLine = function(){
		path = new Path();
		path.strokeColor = 'black';
		path.strokeWidth = 2;
		var rise = Math.abs(endPoint.y-startPoint.y);
		var run = Math.abs(endPoint.x-startPoint.x);
		var slope = Math.atan(rise/run);
		var canvas = document.getElementById('canvas');
		
		
		var width = canvas.width;
		var height = canvas.height;

		// if the line is near horizontal, snap it to horizontal
		if (slope < .1){
			// if the line runs across most of the screen, stretch it.
			if (canvas.width - run < canvas.width/10){
				startPoint = new Point(0, startPoint.y);
				endPoint = new Point(canvas.width, startPoint.y);
			}
			else
				endPoint = new Point(endPoint.x, startPoint.y);
		}
		path.add(startPoint);
		path.add(endPoint);
	}

	// ...... PAPER JS CODE FOR ADDING POINTS ON MOUSE DRAGGING .......
	function onMouseDown(event) {
		// PaperJS add a new Path object and initial starting point
		downtime = new Date().getTime();
		path = new Path();
		path.strokeColor = 'blue';
		path.strokeWidth = 2;
		path.add(event.point);
		startPoint = event.point;
		
		// SRLlib add a new Stroke object and initial starting point
		stroke = new srlib.core.data.container.Stroke();
		point = new srlib.core.data.container.Point(event.point.x,event.point.y)
		startPoint_x = point.x;
		startPoint_y = point.y;
		if (typeof sketch == "undefined") {
			sketch = new srlib.core.data.container.Sketch();
		}
		sketch.addStroke(stroke);
		sketch.addPoint(point);
		stroke.addPoint(point);
	}

	function onMouseDrag(event) {
		// PaperJS add points to Path object on mouse drag
		path.add(event.point);
		point = new srlib.core.data.container.Point(event.point.x,event.point.y)
		sketch.addPoint(point);
		stroke.addPoint(point);
	}

	function onMouseUp(event) {
		// recognize(stroke.getPoints());
		// if (isBox(stroke)){
		uptime = new Date().getTime();
		// if (uptime-downtime < 2000){
		console.log(sketch);
		// }
		if ($('#recognitionOnButton').hasClass('on')){
			path.removeSegments();
			endPoint = event.point;
			var shape = recognize(stroke.getPoints());
			if (shape == "line") addLine();
			if (shape == "rectangle"){
				var coordinates = getExtremes(stroke);
				var width = codeGenerationTextArea(coordinates)[0];
				var height = codeGenerationTextArea(coordinates)[1];
				if ($('#drawTypeButton').hasClass('picture'))
					addTextArea(width, height, startPoint_x, startPoint_y);
				else
					addImage(width, height, startPoint_x, startPoint_y);
			}
			add_jquery();
		}
	}
/*
	<div style="border-style: outset; position:absolute; left: 10; top: 50" >
		<h3>[CVA, CVP, ERA, ERP]</h3>
		<ul id="elementlist">
			<li id="rectangle">Rectangle...[<span>0 0 0 0</span>]</li>
			<li id="circle">Circle.........[<span>0 0 0 0</span>]</li>
			<li id="triangle">Triangle.....[<span>0 0 0 0</span>]</li>
			<li id="line">Line...........[<span>0 0 0 0</span>]</li>
		</ul>
		<center style="font-family: 'Montserrat', sans-serif;">I think its a <span id="prediction">...nothing yet.</span></center>
	</div>

*/
	</script>	
	
	<canvas id="canvas" rezise="true"></canvas>
	
	</body>
</html>

